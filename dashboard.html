<!DOCTYPE html>
<html lang="bg">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—Å–∫–æ —Ç–∞–±–ª–æ</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .dashboard-container {
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
        }
        .welcome-card {
            background: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
        }
        .user-info {
            margin: 20px 0;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 5px;
            text-align: left;
        }
        .user-info p {
            margin: 10px 0;
            font-size: 16px;
        }
        .user-info strong {
            color: #667eea;
            display: inline-block;
            width: 150px;
        }
        .logout-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.3s;
        }
        .logout-btn:hover {
            background: #c82333;
        }
        .admin-link {
            display: inline-block;
            margin-top: 20px;
            color: #667eea;
            text-decoration: none;
            font-weight: 600;
        }
        .admin-link:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <div class="welcome-card">
            <h1>–î–æ–±—Ä–µ –¥–æ—à–ª–∏ –≤ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—Å–∫–æ—Ç–æ —Ç–∞–±–ª–æ!</h1>
            <div class="user-info" id="userInfo">
                –ó–∞—Ä–µ–∂–¥–∞–Ω–µ...
            </div>
            <button class="logout-btn" onclick="logout()">–ò–∑—Ö–æ–¥</button>
            <br>
            <a href="admin-dashboard.html" class="admin-link" id="adminLink" style="display: none;">üîê –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—Å–∫–æ —Ç–∞–±–ª–æ</a>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCtTNJsKJWnOVpRazP5Txz37ll_odEkEo8",
            authDomain: "registration-88c86.firebaseapp.com",
            projectId: "registration-88c86",
            storageBucket: "registration-88c86.firebasestorage.app",
            messagingSenderId: "344139226116",
            appId: "1:344139226116:web:4d1559eab47beab89a2951"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        async function checkIfAdmin(userId) {
            try {
                const userDoc = await db.collection('users').doc(userId).get();
                const userData = userDoc.data();
                return userData?.isAdmin === true || userData?.role === 'admin';
            } catch (error) {
                console.error('–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä:', error);
                return false;
            }
        }

        firebase.auth().onAuthStateChanged(async (user) => {
            if (user) {
                const userDoc = await db.collection('users').doc(user.uid).get();
                const userData = userDoc.data();
                
                const isAdmin = await checkIfAdmin(user.uid);
                
                document.getElementById('userInfo').innerHTML = `
                    <p><strong>–ò–º–µ:</strong> ${userData?.fullName || user.displayName || '–ù–µ –µ –≤—ä–≤–µ–¥–µ–Ω–æ'}</p>
                    <p><strong>–ò–º–µ–π–ª:</strong> ${user.email}</p>
                    <p><strong>–ò–º–µ–π–ª –ø–æ—Ç–≤—ä—Ä–¥–µ–Ω:</strong> ${user.emailVerified ? '‚úÖ' : '‚ùå'}</p>
                    <p><strong>–ú–µ—Ç–æ–¥ –Ω–∞ –≤—Ö–æ–¥:</strong> ${userData?.provider || '–∏–º–µ–π–ª/–ø–∞—Ä–æ–ª–∞'}</p>
                    <p><strong>–†–æ–ª—è:</strong> ${isAdmin ? 'üëë –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä' : 'üë§ –ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª'}</p>
                    <p><strong>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è:</strong> ${userData?.createdAt ? new Date(userData.createdAt.toDate()).toLocaleDateString('bg-BG') : '-'}</p>
                `;

                if (isAdmin) {
                    document.getElementById('adminLink').style.display = 'inline-block';
                }
            } else {
                window.location.href = 'index1.html';
            }
        });

        window.logout = function() {
            firebase.auth().signOut().then(() => {
                window.location.href = 'index1.html';
            });
        };
    </script>
</body>
</html>
