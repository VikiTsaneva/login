<!DOCTYPE html>
<html lang="bg">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–∞–±–ª–æ</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container dashboard-container">
        <h1>üìä –î–æ–±—Ä–µ –¥–æ—à–ª–∏ –≤ —Ç–∞–±–ª–æ—Ç–æ!</h1>
        
        <div class="user-info" id="userInfo">
            <p>–ó–∞—Ä–µ–∂–¥–∞–Ω–µ –Ω–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è...</p>
        </div>
        
        <button id="logoutBtn" class="btn-login btn-logout">–ò–∑—Ö–æ–¥ –æ—Ç —Å–∏—Å—Ç–µ–º–∞—Ç–∞</button>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCtTNJsKJWnOVpRazP5Txz37ll_odEkEo8",
            authDomain: "registration-88c86.firebaseapp.com",
            projectId: "registration-88c86",
            storageBucket: "registration-88c86.firebasestorage.app",
            messagingSenderId: "344139226116",
            appId: "1:344139226116:web:4d1559eab47beab89a2951"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        const userInfo = document.getElementById('userInfo');
        const logoutBtn = document.getElementById('logoutBtn');

        firebase.auth().onAuthStateChanged(async (user) => {
            if (user && user.emailVerified) {
                try {
                    const userDoc = await db.collection('users').doc(user.uid).get();
                    
                    if (userDoc.exists) {
                        const userData = userDoc.data();
                        const creationTime = new Date(user.metadata.creationTime).toLocaleString('bg-BG');
                        const lastSignInTime = new Date(user.metadata.lastSignInTime).toLocaleString('bg-BG');
                        
                        const photoHTML = userData.photoURL 
                            ? `<img src="${userData.photoURL}" alt="Profile" class="profile-image">` 
                            : '';
                        
                        userInfo.innerHTML = `
                            ${photoHTML}
                            <h2 class="user-name">üë§ ${userData.fullName || user.displayName || '–ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª'}</h2>
                            <p><strong>üìß –ò–º–µ–π–ª:</strong> ${user.email} <span class="badge-success">‚úì –ü–æ—Ç–≤—ä—Ä–¥–µ–Ω</span></p>
                            <p><strong>üë§ –ò–º–µ:</strong> ${userData.firstName || '–Ω–µ –µ –ø–æ—Å–æ—á–µ–Ω–æ'}</p>
                            <p><strong>üë• –§–∞–º–∏–ª–∏—è:</strong> ${userData.lastName || '–Ω–µ –µ –ø–æ—Å–æ—á–µ–Ω–∞'}</p>
                            <p><strong>üîê –ú–µ—Ç–æ–¥ –∑–∞ –≤—Ö–æ–¥:</strong> ${userData.provider === 'google' ? 'Google' : '–ò–º–µ–π–ª/–ø–∞—Ä–æ–ª–∞'}</p>
                            <p><strong>üÜî –ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—Å–∫–æ ID:</strong> <code>${user.uid}</code></p>
                            <p><strong>üìÖ –†–µ–≥–∏—Å—Ç—Ä–∏—Ä–∞–Ω –Ω–∞:</strong> ${creationTime}</p>
                            <p><strong>üïê –ü–æ—Å–ª–µ–¥–µ–Ω –≤—Ö–æ–¥:</strong> ${lastSignInTime}</p>
                        `;
                    } else {
                        userInfo.innerHTML = `
                            <p><strong>üë§ –ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª:</strong> ${user.displayName || '–ë–µ–∑ –∏–º–µ'}</p>
                            <p><strong>üìß –ò–º–µ–π–ª:</strong> ${user.email}</p>
                        `;
                    }
                } catch (error) {
                    console.error('–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –∑–∞—Ä–µ–∂–¥–∞–Ω–µ –Ω–∞ –¥–∞–Ω–Ω–∏:', error);
                    userInfo.innerHTML = '<p>–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –∑–∞—Ä–µ–∂–¥–∞–Ω–µ –Ω–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è—Ç–∞</p>';
                }
            } else {
                window.location.href = 'index.html';
            }
        });

        logoutBtn.addEventListener('click', () => {
            firebase.auth().signOut()
                .then(() => {
                    window.location.href = 'index.html';
                })
                .catch((error) => {
                    alert('–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –∏–∑—Ö–æ–¥: ' + error.message);
                });
        });
    </script>
</body>
</html>